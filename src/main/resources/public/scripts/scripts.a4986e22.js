"use strict";function routeConfig(a,b){a.state("home",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"ctrl"}).state("history",{url:"/history/:river",templateUrl:"views/history.html",controller:"HistoryCtrl",controllerAs:"ctrl"}),b.otherwise("/")}angular.module("alertasEnchentesApp",["ngAnimate","ngSanitize","ngTouch","ngResource","ui.router","openlayers-directive"]).constant("RESTAPI",{url:"http://enchentes.infoamazonia.org:8080"}).config(routeConfig),routeConfig.$inject=["$stateProvider","$urlRouterProvider"],function(){function a(a,b){function c(){d("riomadeira")}function d(a){for(var b=0;b<f.rivers.length;b++)if(f.rivers[b].slug===a){f.selectedRiver=f.rivers[b],f.loading=!0;break}}function e(a){return f.selectedRiver.slug===a}var f=this;f.loading=!0,f.rivers=[{slug:"rioacre",name:"Rio Acre",station:13600002,history:{}},{slug:"riomadeira",name:"Rio Madeira",station:154e5,history:{}},{slug:"manaus",name:"Rio Amazonas",station:1499e4,history:{}}],f.selectedRiver={},f.selectRiver=d,f.isSelectedRiver=e;var g=$(window).width()<=998;f.map={center:{lat:-9.43651,lon:-65.616777,zoom:g?4:6},layers:[{name:"Satellite",active:!0,source:{type:"MapBox",mapId:"mapbox.satellite",accessToken:"pk.eyJ1IjoiamVmZmVyc29ucnBuIiwiYSI6ImNpcnZhc2FoMTBpZGtmYW04M3IyZTZ6NWoifQ.xTtlY-a--vOAS25Op_7uIA"}}],markers:[{lat:-9.972892,lon:-67.791799,label:{message:"Rio Acre",show:!0,showOnMouseOver:!0}},{lat:-8.748149,lon:-63.917471,label:{message:"Rio Madeira",show:!0,showOnMouseOver:!0}}],defaults:{events:{layers:["mousemove","click"]},controls:{zoom:!1,rotate:!1,attribution:!1},interactions:{mouseWheelZoom:!1},view:{maxZoom:16,minZoom:4}}},c();var h=angular.element(b),i=function(){a.scroll=h.scrollTop()};h.on("scroll",a.$apply.bind(a,i)),i()}angular.module("alertasEnchentesApp").controller("MainCtrl",a),a.$inject=["$scope","$window"]}(),function(){function a(a,b,c,d){function e(){var a="rioacre";c.river&&(a=c.river),f(a)}function f(a){for(var b=0;b<h.rivers.length;b++)if(h.rivers[b].slug===a){h.selectedRiver=h.rivers[b],h.loading=!0,d.get({id:h.selectedRiver.station},function(a){h.selectedRiver.history=a,h.loading=!1});break}}function g(a){return h.selectedRiver.slug===a}var h=this;h.loading=!0,h.rivers=[{slug:"rioacre",name:"Rio Acre",station:13600002,history:{}},{slug:"riomadeira",name:"Rio Madeira",station:154e5,history:{}},{slug:"rioamazonas",name:"Rio Amazonas",station:1499e4,history:{}}],h.selectedRiver={},h.selectRiver=f,h.isSelectedRiver=g,e();var i=angular.element(b),j=function(){a.scroll=i.scrollTop()};i.on("scroll",a.$apply.bind(a,j)),j()}angular.module("alertasEnchentesApp").controller("HistoryCtrl",a),a.$inject=["$scope","$window","$stateParams","History"]}(),function(){function a(){return{template:"<svg></svg>",restrict:"E",scope:{river:"="},link:function(a,b){function c(a){function b(a,b){var c=Math.abs(b.getTime()-a.getTime());return Math.ceil(c/864e5)}function c(){x.empty()?(q.domain(r.domain()),O={data:null,min:null,max:null},P.text(""),Q.text(""),G.transition(500).attr("opacity",0)):(q.domain(x.extent()),O=d(R,x.extent()),P.text("Máxima de "+O.max.value+"m"),Q.text("Mínima de "+O.min.value+"m"),P.attr("transform","translate("+q(O.max.date)+","+s(O.max.value)+")"),Q.attr("transform","translate("+q(O.min.date)+","+s(O.min.value)+")"),G.transition(1e3).attr("opacity",1),G.select(".dots.line-max").attr("x1",q(O.max.date)).attr("y1",s(O.max.value)-30).attr("x2",q(O.max.date)).attr("y2",s(O.max.value)),G.select(".dots.line-min").attr("x1",q(O.min.date)).attr("y1",s(O.min.value)-30).attr("x2",q(O.min.date)).attr("y2",s(O.min.value))),C.select(".area").attr("d",y(R)),C.select(".area.area-null").attr("d",y(U)),C.select(".line").attr("d",z(R)),C.select(".x.axis").call(u)}function f(){I.style("display",null)}function g(){I.style("display","none")}function o(){var a=q.invert(e.mouse(this)[0]),b=n(R,a,1),c=R[b-1],d=R[b],f=a-c.date>d.date-a?d:c;K.attr("transform","translate("+q(f.date)+","+s(f.measured)+")"),J.attr({x1:q(f.date),y1:s(Y)-m,x2:q(f.date),y2:s(0)}),M.attr("transform","translate("+q(f.date)+","+(s(Y)-l/2-m)+")"),M.text(f.measured+"m em "+p(f.date)),L.attr({x:q(f.date)-k/2,y:s(Y)-l-m})}function B(){x.extent([new Date(this.innerHTML+"-01-01"),new Date(this.innerHTML+"-12-31")]),x(e.select(".brush").transition()),x.event(e.select(".brush").transition())}var R=[];a.data.forEach(function(a){a.measured&&R.push({date:new Date(a.timestamp),measured:Math.round(.001*a.measured*100)/100})});var S=Math.round(.001*a.info.warningThreshold*100)/100,T=Math.round(.001*a.info.floodThreshold*100)/100;R.sort(function(a,b){return a.date-b.date});for(var U=[],V=0;V<R.length-1;V++){if(U.push(R[V]),b(R[V+1].date,R[V].date)>30){var W={date:R[V].date,measured:null};U.push(W);var X={date:R[V+1].date,measured:null};U.push(X)}R.length-2===V&&U.push(R[V+1])}var Y=e.max(R.map(function(a){return a.measured})),Z=e.extent(R.map(function(a){return a.date})),$=Z,_=R[R.length-1].date,aa=new Date(_);aa=new Date(aa.setMonth(aa.getMonth()-120)),$=[aa,_],q.domain(Z),s.domain([0,Y]),r.domain(q.domain()),t.domain(s.domain()),D.attr("d",y(R)),E.attr("d",y(U)),F.attr("d",z(R)),S>0&&C.append("line").attr("class","warning-line").attr("x1",0).attr("y1",s(S)).attr("x2",h).attr("y2",s(S)),T>0&&C.append("line").attr("class","flood-line").attr("x1",0).attr("y1",s(T)).attr("x2",h).attr("y2",s(T)),G.append("line").attr("class","dots line-max"),G.append("line").attr("class","dots line-min"),C.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(u),C.append("g").attr("class","y axis").call(w).append("text").attr("y",6).attr("dy",".71em").style("text-anchor","end").attr("transform","rotate(-90)").text("Volume (m)"),N.append("path").datum(R).attr("class","area2").attr("d",A),N.append("g").attr("class","x axis").attr("transform","translate(0,"+j+")").call(v),N.selectAll(".tick text").on("click",B),N.append("g").attr("class","x brush").call(x).selectAll("rect").attr("y",-6).attr("height",j+7),H.on("mouseover",f).on("mouseout",g).on("mousemove",o),x.extent($),x.on("brush",c),N.select(".brush").call(x),c()}function d(a,b){var c;_.find(a,function(a,d){return c=d,b[0].getFullYear()===a.date.getFullYear()&&b[0].getMonth()===a.date.getMonth()});var d=_.rest(a,c),e=[];_.find(d,function(a){return e.push(a),b[1].getFullYear()===a.date.getFullYear()&&b[1].getMonth()===a.date.getMonth()});var f,g,h=-9999,i=9999;return _.each(e,function(a){a.measured>h&&(h=a.measured,f=a.date),a.measured<i&&(i=a.measured,g=a.date)}),{data:e,min:{value:i,date:g},max:{value:h,date:f}}}var e=d3,f={top:80,right:10,bottom:100,left:40},g={top:430,right:10,bottom:20,left:40},h=1960-f.left-f.right,i=500-f.top-f.bottom,j=500-g.top-g.bottom,k=300,l=30,m=45,n=e.bisector(function(a){return a.date}).left,o=e.locale({decimal:",",thousands:".",grouping:[3],currency:["R$",""],dateTime:"%d/%m/%Y %H:%M:%S",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],shortDays:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],shortMonths:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"]}),p=o.timeFormat("%d de %B  de %Y"),q=e.time.scale().range([0,h]),r=e.time.scale().range([0,h]),s=e.scale.linear().range([i,0]),t=e.scale.linear().range([j,0]),u=e.svg.axis().scale(q),v=e.svg.axis().scale(r).orient("bottom").ticks(e.time.year),w=e.svg.axis().scale(s).orient("left"),x=e.svg.brush().x(r),y=e.svg.area().x(function(a){return q(a.date)}).y0(i).y1(function(a){return s(a.measured)}),z=e.svg.line().defined(function(a){return a.measured}).x(function(a){return q(a.date)}).y(function(a){return s(a.measured)}),A=e.svg.area().interpolate("monotone").x(function(a){return r(a.date)}).y0(j).y1(function(a){return t(a.measured)}),B=e.select("svg").attr({class:"timeline-chart",version:"1.1",viewBox:"0 0 "+(h+f.left+f.right)+" "+(i+f.top+f.bottom),width:"100%"});B.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",h).attr("height",i+f.top).attr("transform","translate(0,"+-f.top+")");var C=B.append("g").attr("class","focus").attr("transform","translate("+f.left+","+f.top+")"),D=C.append("path").attr("class","area"),E=C.append("path").attr("class","area area-null"),F=C.append("path").attr("class","line"),G=C.append("g").attr("class","dots").attr("opacity",0),H=C.append("rect").attr("width",h).attr("height",i).style("fill","none").style("pointer-events","all"),I=C.append("g").attr("class","selected-value").style("display","none"),J=I.append("line"),K=I.append("g");K.append("circle").attr("r",8),K.append("circle").attr("r",5);var L=I.append("rect").attr("rx",4).attr("ry",4).attr("width",k).attr("height",l),M=I.append("text").attr("x",9).attr("dy",".35em").attr("text-anchor","middle"),N=B.append("g").attr("class","context").attr("transform","translate("+g.left+","+g.top+")"),O={data:null,min:null,max:null},P=B.append("text").attr("class","legend").attr("x",f.left+4).attr("y",50).attr("text-anchor","start").attr("alignment-baseline","hanging").text(""),Q=B.append("text").attr("class","legend").attr("x",f.left+4).attr("y",50).attr("text-anchor","start").attr("alignment-baseline","hanging").text("");a.$watch(function(a){return a.river},function(a){"undefined"!=typeof a&&a.data&&c(a)})}}}angular.module("alertasEnchentesApp").directive("aeHistory",a),a.$inject=[]}(),function(){function a(a){return{templateUrl:"views/directives/ae-navbar.html",restrict:"E",scope:{scroll:"=scrollPosition",selectRiver:"&"},link:function(b,c,d){var e=angular.element(a),f=function(){b.scroll=e.scrollTop()};e.on("scroll",b.$apply.bind(b,f)),f()}}}angular.module("alertasEnchentesApp").directive("aeNavbar",a),a.$inject=["$window"]}(),function(){function a(a,b){return b(a.url+"/station/:id/history")}angular.module("alertasEnchentesApp").factory("History",a),a.$inject=["RESTAPI","$resource"]}(),angular.module("alertasEnchentesApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/directives/ae-navbar.html",'<nav class="navbar navbar-fixed-top" ng-class="{\'navbar-inverse\': scroll > 150, \'navbar-default\': scroll <= 150}"> <div class="container-fluid"> <!-- Brand and toggle get grouped for better mobile display --> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" ui-sref="home"> <img src="images/ia-white.2cc19e45.png" alt="Infoamazônia" width="185" height="40"> </a> </div> <!-- Collect the nav links, forms, and other content for toggling --> <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"> <ul class="nav navbar-nav navbar-right"> <li><a ui-sref="riobranco">Rio Branco</a></li> <li><a ui-sref="portovelho">Porto Velho</a></li> <li><a ui-sref="manaus">Manaus</a></li> </ul> </div><!-- /.navbar-collapse --> </div><!-- /.container-fluid --> </nav>'),a.put("views/history.html",'<nav class="navbar navbar-fixed-top" ng-class="{\'navbar-inverse\': scroll > 150, \'navbar-default\': scroll <= 150}"> <div class="container-fluid"> <!-- Brand and toggle get grouped for better mobile display --> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" ui-sref="home"> <img src="images/ia-white.2cc19e45.png" alt="Infoamazônia" width="185" height="40"> </a> </div> <!-- Collect the nav links, forms, and other content for toggling --> <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"> <ul class="nav navbar-nav navbar-right"> <li class="dropdown"> <a href="" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Previsões <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="" ng-click="ctrl.selectRiver(\'rioacre\')">Rio Acre</a></li> <li><a href="" ng-click="ctrl.selectRiver(\'riomadeira\')">Rio Madeira</a></li> </ul> </li> <li class="dropdown"> <a href="" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Séries históricas <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a ui-sref="history({river: \'rioacre\'})">Rio Acre</a></li> <li><a ui-sref="history({river: \'riomadeira\'})">Rio Madeira</a></li> <li><a ui-sref="history({river: \'rioamazonas\'})">Rio Amazonas</a></li> </ul> </li> </ul> </div><!-- /.navbar-collapse --> </div><!-- /.container-fluid --> </nav> <div class="content-main section-primary"> <div class="container-fluid"> <h2 class="text-center">Série histórica do {{ctrl.selectedRiver.name}}</h2> <div class="loading" ng-show="ctrl.loading"> <div class="loading-speeding-wheel"></div> </div> <!-- {{ctrl.selectedRiver.history | json}} --> <ae-history river="ctrl.selectedRiver.history"></ae-history> </div> </div>'),a.put("views/main.html",'<nav class="navbar navbar-fixed-top" ng-class="{\'navbar-inverse\': scroll > 150, \'navbar-default\': scroll <= 150}"> <div class="container-fluid"> <!-- Brand and toggle get grouped for better mobile display --> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" ui-sref="home"> <img src="images/ia-white.2cc19e45.png" alt="Infoamazônia" width="185" height="40"> </a> </div> <!-- Collect the nav links, forms, and other content for toggling --> <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"> <ul class="nav navbar-nav navbar-right"> <li class="dropdown"> <a href="" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Previsões <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="" ng-click="ctrl.selectRiver(\'rioacre\')">Rio Acre</a></li> <li><a href="" ng-click="ctrl.selectRiver(\'riomadeira\')">Rio Madeira</a></li> </ul> </li> <li class="dropdown"> <a href="" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Séries históricas <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a ui-sref="history({river: \'rioacre\'})">Rio Acre</a></li> <li><a ui-sref="history({river: \'riomadeira\'})">Rio Madeira</a></li> <li><a ui-sref="history({river: \'rioamazonas\'})">Rio Amazonas</a></li> </ul> </li> </ul> </div><!-- /.navbar-collapse --> </div><!-- /.container-fluid --> </nav> <openlayers class="content-fullheight" ol-defaults="ctrl.map.defaults" ol-center="ctrl.map.center"> <ol-marker ol-marker-properties="marker" ng-repeat="marker in ctrl.map.markers"></ol-marker> <ol-layer name="{{layer.name}}" ol-layer-properties="layer" ng-repeat="layer in ctrl.map.layers"></ol-layer> </openlayers> <div class="map-headding text-center"> <h1>Alerta de enchentes</h1> <p class="map-subheadding">Veja as previsões de volume para os rios da região amazônica</p> </div> <div class="map-info"> <div class="map-info-content"> <div data-alerta-enchentes-station="13600002" ng-show="ctrl.isSelectedRiver(\'rioacre\')"></div> <div data-alerta-enchentes-station="15400000" ng-show="ctrl.isSelectedRiver(\'riomadeira\')"></div> <script type="text/javascript">(function() {\n      var script = document.createElement(\'script\');\n      script.async = true;\n      script.src   = "http://enchentes.infoamazonia.org:8080/scripts/alerta-enchentes.js";\n      var entry = document.getElementsByTagName(\'script\')[0];\n      entry.parentNode.insertBefore(script, entry);\n    }());</script> </div> </div> <div class="clearfix"></div>'),a.put("views/manaus.html",'<section class="section-header"> <div class="container inner"> <header> <h1>Alerta de enchentes</h1> <p>Veja as previsões de volume para os rios da região amazônica</p> </header> <div class="row"> <div class="col-md-4"> <h2 class="major">Manaus</h2> </div> </div> </div> </section> <section class="section-primary"> <div class="container-fluid"> <h2 class="text-center">Série histórica</h2> <div class="loading" ng-show="ctrl.loading"> <div class="loading-speeding-wheel"></div> </div> <ae-history river="ctrl.river"></ae-history> </div> </section>'),a.put("views/portovelho.html",'<section class="section-header"> <div class="container inner"> <header> <h1>Alerta de enchentes</h1> <p>Veja as previsões de volume para os rios da região amazônica</p> </header> <div class="row"> <div class="col-md-4"> <h2 class="major">Porto Velho</h2> <p>Observando as medições do volume das estações Abunã, Morada Nova e Guajará Mirim, podemos antecipar as enchentes em Porto Velho e região.</p> </div> <div class="col-md-8"> <div data-alerta-enchentes-station="15400000"></div> <script type="text/javascript">(function() {\n              var script = document.createElement(\'script\');\n              script.async = true;\n              script.src   = "http://enchentes.infoamazonia.org:8080/scripts/alerta-enchentes.js";\n              var entry = document.getElementsByTagName(\'script\')[0];\n              entry.parentNode.insertBefore(script, entry);\n          }());</script> </div> </div> </div> </section> <section class="section-primary"> <div class="container-fluid"> <h2 class="text-center">Série histórica</h2> <div class="loading" ng-show="ctrl.loading"> <div class="loading-speeding-wheel"></div> </div> <ae-history river="ctrl.river"></ae-history> </div> </section>'),a.put("views/riobranco.html",'<section class="section-header"> <div class="container inner"> <header> <h1>Alerta de enchentes</h1> <p>Veja as previsões de volume para os rios da região amazônica</p> </header> <div class="row"> <div class="col-md-4"> <h2 class="major">Rio Branco</h2> <p>Observando as medições do volume da estação Xapuri, podemos antecipar as enchentes em Rio Branco e região.</p> </div> <div class="col-md-8"> <div data-alerta-enchentes-station="13600002"></div> <script type="text/javascript">(function() {\n              var script = document.createElement(\'script\');\n              script.async = true;\n              script.src   = "http://enchentes.infoamazonia.org:8080/scripts/alerta-enchentes.js";\n              var entry = document.getElementsByTagName(\'script\')[0];\n              entry.parentNode.insertBefore(script, entry);\n          }());</script> </div> </div> </div> </section> <section class="section-primary"> <div class="container-fluid"> <h2 class="text-center">Série histórica</h2> <div class="loading" ng-show="ctrl.loading"> <div class="loading-speeding-wheel"></div> </div> <ae-history river="ctrl.river"></ae-history> </div> </section>')}]);